# 경북대학교 의과대학 성적 알림 봇

경북대학교 의과대학 학사 행정 시스템의 성적 변동을 주기적으로 확인하고, 텔레그램 봇을 통해 알림을 제공하는 자동화 스크립트입니다. 본 README는 한국어 사용자를 위해 작성되었습니다.

## 주요 기능
- Selenium WebDriver를 활용한 자동 로그인 및 성적 페이지 접근
- 성적 변동 시 텔레그램 메시지 발송
- 30분 주기 상태 보고(새로고침 횟수 포함)
- 예외 발생 시 자동 재로그인 및 오류 알림

## 디렉터리 구조
```
./
├── knusc.py              # 메인 실행 스크립트
├── PROGRAM_STRUCTURE.md  # 프로그램 구조 및 흐름도 (Mermaid)
└── last_grade.txt        # 최근 성적 스냅샷 (실행 후 생성)
```

## 선행 조건
1. Python 3.9 이상 권장
2. 크롬 브라우저 및 ChromeDriver 설치 (버전 일치 필요)
3. Selenium, python-dotenv, requests 등의 패키지 설치

```bash
pip install -r requirements.txt  # 또는 개별 패키지 설치
```
> `requirements.txt`가 없다면 다음 명령으로 필요한 패키지를 설치하세요.
> ```bash
> pip install selenium python-dotenv requests
> ```

## 환경 변수 설정 (.env)
프로젝트 루트에 `.env` 파일을 생성하고 다음 값을 입력하세요.
```
KNU_ID=학번또는ID
KNU_PW=비밀번호
TELEGRAM_TOKEN=텔레그램봇토큰
TELEGRAM_CHAT_ID=메시지를받을채팅ID
```
- 텔레그램 봇 토큰은 [BotFather](https://t.me/BotFather)를 통해 생성합니다.
- `TELEGRAM_CHAT_ID`는 @userinfobot 또는 별도의 API 호출로 확인할 수 있습니다.

## 실행 방법
```bash
python knusc.py
```
- 최초 실행 시 콘솔에 초기화 메시지가 출력되며, 텔레그램으로 봇 시작 알림이 전송됩니다.
- 로그인 실패 시 텔레그램과 콘솔에 오류 메시지가 표시되며 프로그램이 종료됩니다.

## 동작 요약
1. `.env`에서 계정 및 텔레그램 정보 로딩
2. Selenium으로 로그인 페이지 접속 및 자격 증명 입력
3. 성적 페이지 이동 후 `record-list` 텍스트 추출
4. 이전 성적과 비교하여 변동 감지
5. 변동 시 텔레그램 알림 및 `last_grade.txt` 업데이트
6. 변동이 없어도 30분마다 상태 보고 메시지 전송
7. 무작위(90~150초) 대기 후 페이지 새로고침 반복
8. 예외 발생 시 재로그인 시도 및 오류 알림, 재로그인 실패 시 10분 대기

## 로그 및 데이터 파일
- `last_grade.txt`: 마지막으로 확인한 성적표를 저장하여 변동 여부 판단에 사용합니다.
- 콘솔 로그: 실행 중 상세한 상태와 예외 정보를 제공합니다.

## 문제 해결 팁
- **로그인 실패:** 아이디/비밀번호가 정확한지 확인하고, 보안 문자 또는 사이트 구조 변경 여부를 점검하세요.
- **Selenium 오류:** ChromeDriver와 크롬 브라우저 버전이 호환되는지 확인합니다.
- **텔레그램 미수신:** 토큰과 채팅 ID가 올바른지, 봇이 채널/그룹에 추가되어 있는지 확인합니다.
- **반복 오류로 인한 차단 우려:** 필요 시 `options.add_argument("--headless")` 주석을 해제하여 백그라운드 실행을 활용하십시오.

## 보안 및 운영상의 주의
- `.env` 파일과 `last_grade.txt`에는 민감 정보가 포함될 수 있으므로 접근 권한을 제한하세요.
- 공용 서버에서 실행 시, 텔레그램 알림을 통해 외부에 정보가 노출되지 않도록 주의합니다.
- 장시간 실행을 위해선 시스템 리소스 사용량(메모리, CPU)을 모니터링하는 것이 좋습니다.

## 라이선스 및 기여
- 본 프로젝트는 개인 용도로 작성되었습니다. 공유 또는 배포 시 개인정보 유출에 주의하십시오.
- 기여 제안은 Pull Request 또는 이슈로 남겨주세요.

